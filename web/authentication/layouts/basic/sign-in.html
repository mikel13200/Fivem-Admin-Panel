<!DOCTYPE html>
<html lang="en">
	<!--begin::Head-->
	<head><base href="../../../">
		<title>Iniciar Sesión - StaffPanel</title>
		<meta charset="utf-8" />
		<meta name="description" content="The most advanced Bootstrap Admin Theme on Themeforest trusted by 94,000 beginners and professionals. Multi-demo, Dark Mode, RTL support and complete React, Angular, Vue &amp; Laravel versions. Grab your copy now and get life-time updates for free." />
		<meta name="keywords" content="Metronic, bootstrap, bootstrap 5, Angular, VueJs, React, Laravel, admin themes, web design, figma, web development, free templates, free admin themes, bootstrap theme, bootstrap template, bootstrap dashboard, bootstrap dak mode, bootstrap button, bootstrap datepicker, bootstrap timepicker, fullcalendar, datatables, flaticon" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<meta property="og:locale" content="en_US" />
		<meta property="og:type" content="article" />
		<meta property="og:title" content="Metronic - Bootstrap 5 HTML, VueJS, React, Angular &amp; Laravel Admin Dashboard Theme" />
		<meta property="og:url" content="https://keenthemes.com/metronic" />
		<meta property="og:site_name" content="Keenthemes | Metronic" />
		<link rel="canonical" href="https://preview.keenthemes.com/metronic8" />
		<link rel="shortcut icon" href="assets/media/logos/favicon.ico" />
		<!--begin::Fonts-->
		<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Poppins:300,400,500,600,700" />
		<!--end::Fonts-->
		<!--begin::Global Stylesheets Bundle(used by all pages)-->
		<link href="assets/plugins/global/plugins.bundle.css" rel="stylesheet" type="text/css" />
		<link href="assets/css/style.bundle.css" rel="stylesheet" type="text/css" />
		<!--end::Global Stylesheets Bundle-->
	</head>
	<!--end::Head-->
	<!--begin::Body-->
	<body id="kt_body" class="bg-body">
		<!--begin::Main-->
		<!--begin::Root-->
		<div class="d-flex flex-column flex-root">
			<!--begin::Authentication - Sign-in -->
			<div class="d-flex flex-column flex-column-fluid bgi-position-y-bottom position-x-center bgi-no-repeat bgi-size-contain bgi-attachment-fixed" style="background-image: url(https://cdn.wallpapersafari.com/88/22/j3m0fn.jpg);background-size: 1920px 1080px;"">
				<!--begin::Content-->
				<div class="d-flex flex-center flex-column flex-column-fluid p-10 pb-lg-20">
					<!--begin::Wrapper-->
					<div class="w-lg-500px bg-body rounded shadow-sm p-10 p-lg-15 mx-auto">
						<!--begin::Form-->
						<form class="form w-100" novalidate="novalidate">

							<!--begin::Heading-->
							<div class="text-center mb-10">
								<!--begin::Title-->
								<h1 class="text-dark mb-3">Bienvenido a Panel </h1>
								<!--end::Link-->
							</div>
							<!--begin::Heading-->
							<!--begin::Input group-->
							<div class="fv-row mb-10">
								<!--begin::Label-->
								<label class="form-label fs-6 fw-bolder text-dark">Nombre de Usuario</label>
								<!--end::Label-->
								<!--begin::Input-->
								<input class="form-control form-control-lg form-control-solid" type="text" id="username" name="email" autocomplete="off" />
								<!--end::Input-->
							</div>
							<!--end::Input group-->
							<!--begin::Input group-->
							<div class="fv-row mb-10">
								<!--begin::Wrapper-->
								<div class="d-flex flex-stack mb-2">
									<!--begin::Label-->
									<label class="form-label fw-bolder text-dark fs-6 mb-0">Contraseña</label>
									<!--end::Label-->
									<!--begin::Link-->
									
									<!--end::Link-->
								</div>
								<!--end::Wrapper-->
								<!--begin::Input-->
								<input class="form-control form-control-lg form-control-solid" type="password" id="password" name="password" autocomplete="off" />
								<!--end::Input-->
							</div>
							<!--end::Input group-->
							<!--begin::Actions-->
							<div class="text-center">
								<!--begin::Submit button-->
								<button type="submit" id="btLogin" onclick="submit_form()" class="btn btn-lg btn-primary w-100 mb-5">
									<span class="indicator-label">Continuar</span>
									<span class="indicator-progress">Por favor espere...
									<span class="spinner-border spinner-border-sm align-middle ms-2"></span></span>
								</button>
								<!--end::Submit button-->
								<!--end::Separator-->
								<div id="AlreadyLoged" style="display:none">
									<div class="alert alert-primary d-flex align-items-center p-5 mb-10">
										<!--begin::Svg Icon | path: icons/duotune/general/gen048.svg-->
										<!--end::Svg Icon-->
										<div class="d-flex flex-column">
											<h4 class="mb-1 text-primary">Advertencia</h4>
											<span>Ya tienes una sesión iniciada en este navegador, si quieres cerrarla pulsa <a href="functions/deleteCookie.php?redirect=../authentication/layouts/basic/sign-in.html">aquí</a>.</span>
										</div>
									</div>
								</div>
								<div id="BadCredentials" style="display:none">
									<div class="alert alert-danger d-flex align-items-center p-5 mb-10">
										<div class="d-flex flex-column">
											<h4 class="mb-1 text-danger">Error</h4>
											<span>Ningún Usuario coincide con las credenciales introducidas. Si tienes algún problema contacta con el administrador.</span>
										</div>
									</div>
								</div>
							</div>
							<!--end::Actions-->
						</form>
						<!--end::Form-->
					</div>
					<!--end::Wrapper-->
				</div>
				<!--end::Content-->
				<!--begin::Footer-->
				<!--end::Footer-->
			</div>
			<!--end::Authentication - Sign-in-->
		</div>
		<script type="text/javascript">
		function getCookie(name) {
			var match = document.cookie.match(RegExp('(?:^|;\\s*)' + name + '=([^;]*)')); 
			return match ? match[1] : null;
		}

		function delete_cookie() {
			document.cookie = 'PHPSESSID=; Path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;';
		}

		if(getCookie("PHPSESSID") != null) {
			//let errorAnswer = document.getElementById("AlreadyLoged").style.display = "block";
			console.log(getCookie("PHPSESSID"))
		}

		function submit_form(){ 
			let btLoginIndicator = document.getElementById("btLogin").setAttribute("data-kt-indicator", "on");
			let btLoginDisabled = document.getElementById("btLogin").setAttribute("disabled", "");
			var url = "http://yourapi.com/api/login";

			var xhr = new XMLHttpRequest();
			xhr.open("POST", url);

			xhr.setRequestHeader("Accept", "application/json");
			xhr.setRequestHeader("Content-Type", "application/json");

			xhr.onreadystatechange = function () {
			if (xhr.readyState === 4) {
				console.log(xhr.status);
				var obj = JSON.parse(xhr.responseText);
				if(obj.Status != 'Bad') {
					window.location.href = `functions/setCookie.php?cookie=${obj.Cookie}&redirect=../dashboards/index.php`;
				} else {
					let btLoginIndicator = document.getElementById("btLogin").removeAttribute("data-kt-indicator");
					let btLoginDisabled = document.getElementById("btLogin").removeAttribute("disabled");
					let errorAnswer = document.getElementById("BadCredentials").style.display = "block";
				}
			}};

			let usernameValue = document.getElementById("username").value; 
			let passwordValue = document.getElementById("password").value;

			var data = `{
			"username": "${usernameValue}",
			"password": "${passwordValue}"
			}`;

			xhr.send(data);
		}  
		</script>
		<!--begin::Javascript-->
		<script>var hostUrl = "assets/";</script>
		<!--begin::Global Javascript Bundle(used by all pages)-->
		<script src="assets/plugins/global/plugins.bundle.js"></script>
		<script src="assets/js/scripts.bundle.js"></script>
		<!--end::Global Javascript Bundle-->
		<!--begin::Page Custom Javascript(used by this page)-->
		<script src="assets/js/custom/authentication/sign-in/general.js"></script>
		<!--end::Page Custom Javascript-->
		<!--end::Javascript-->
	</body>
	<!--end::Body-->
</html>